<div class="page-width">
  {%- paginate collection.products by section.settings.products_per_page -%}
    <!-- Add product count and loading live region -->
    <div
      role="status"
      class="sr-only"
      id="product-count-announcer"
      aria-live="polite"
    >
      {{ collection.products.size }}
      {{ 'accessibility.products_count' | t }}
    </div>

    <infinite-scroll-collections
      data-current-page="{{ paginate.current_page }}"
      data-total-pages="{{ paginate.pages }}"
      data-loading-label="{{ 'accessibility.loading' | t }}"
      data-products-count-label="{{ 'accessibility.products_count' | t }}"
    >
      {%- if collection.products.size == 0 -%}
        <div id="product-grid" data-id="{{ section.id }}">
          <div>
            <h2>{{ 'sections.collection_template.empty' | t -}}</h2>
          </div>
        </div>
      {%- else -%}
        <div>
          <ul
            id="product-grid"
            data-id="{{ section.id }}"
            class="grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4 list-unstyled"
            role="list"
            {%- if section.settings.enable_infinite_scroll -%}
              aria-live="polite"
            {%- endif -%}
          >
            {%- for product in collection.products -%}
              {% assign lazy_load = false %}
              {%- if forloop.index > 2 -%}
                {%- assign lazy_load = true -%}
              {%- endif -%}
              <li>
                {% render 'product-card',
                  product: product,
                  show_vendor: section.settings.show_vendor,
                  show_rating: section.settings.show_rating,
                  lazy_load: lazy_load,
                  section_id: section.id
                %}
              </li>
            {%- endfor -%}
          </ul>

          <!-- Loading Indicator -->
          {%- if section.settings.enable_infinite_scroll -%}
            <div
              class="infinite-scroll-loading py-20"
              style="display: none;"
            >
              <div class="loading"></div>
            </div>
          {%- endif -%}

          {%- if paginate.pages > 1 -%}
            {% render 'pagination', paginate: paginate, anchor: '' %}
          {%- endif -%}
        </div>
      {%- endif -%}
    </infinite-scroll-collections>
  {%- endpaginate -%}
</div>

{%- if section.settings.enable_infinite_scroll -%}
  <script src="{{ 'infinite-scroll-collections.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{% schema %}
{
  "name": "t:names.product-grid",
  "class": "section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 36,
      "step": 4,
      "default": 16,
      "label": "t:settings.products_per_page"
    },
    {
      "type": "checkbox",
      "id": "enable_infinite_scroll",
      "default": false,
      "label": "t:settings.enable_infinite_scroll",
      "info": "t:info.enable_infinite_scroll"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": true,
      "label": "t:settings.show_vendor"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "t:settings.show_rating",
      "info": "t:info.show_rating"
    }
  ]
}
{% endschema %}
